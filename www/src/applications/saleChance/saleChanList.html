<ion-view class="saleList saleChanList">
    <div ng-if="!searchFlag">
        <ion-header-bar align-title="center" class="head pub-head">
            <div class="row row-center">
                <a class="col col-20 text-left goBack" ng-click="goBack()"><i class="ion-chevron-left"></i></a>

                <div class="col col-60 text-center">{{saleTitleText}}</div>
                <div class="col col-20 add button-clear button preVentScrollTop" ng-click="openCreatePop()"><img src="img/saleList/add.png"></div>
            </div>
        </ion-header-bar>
        <div class="pub-subhead bar bar-subheader">
            <div class="row row-center no-padding" ng-click="changeSearch()">
                <i class="ion-ios-search"></i>请输入机会关键字
            </div>
        </div>
    </div>
    <div class="referModal" ng-if="searchFlag">
        <ion-header-bar class="head" no-tap-scroll="true">
            <div class="row row-center">
                <div class="text-center selections" ng-click="changeFilterFlag($event)">
                    筛选<img class="chanceImg" src="img/saleList/oval.png">
                </div>
                <div class="col input">
                    <div class="row row-center no-padding">
                        <i class="ion-ios-search"></i>
                        <input id="saleChanListSearchId" focus-me type="search" ng-change="getCustomerArr(input.list)"
                               ng-model="input.customer" placeholder="请输入关键字">
                        <i class="ion-ios-close" ng-if="input.list" ng-click="initCustomerSearch()"></i>
                    </div>
                </div>
                <div class="col col-15 text-center cancel" ng-click="changeSearch()">取消</div>
            </div>
        </ion-header-bar>
    </div>
    <ion-content class="has-subheader content" ng-hide="searchFlag">
        <ion-refresher pulling-text="下拉刷新..." on-refresh="getList('refresh')"></ion-refresher>
        <div class="list">
            <a ng-click="goDetail(x,$event)" class="item animated flipInX" ng-repeat="x in saleListArr">
                <div class="row row-center">
                    <img class="title_oval" src="img/saleDetail/title_oval.png">
                    <div class="title" ng-bind-html="x.DESCRIPTION"></div>
                </div>
                <div class="row row-center sub-title">
                    <div class="col no-padding">潜在客户:&nbsp;&nbsp;{{x.PARTNER_TXT}}</div>
                </div>
                <div class="row row-center sub-title" style="padding-top: 2px">
                    <div class="col col-50 no-padding">销售阶段:&nbsp;&nbsp;{{x.PHASE}}</div>
                    <div class="col col-50 chanStatus">状态:&nbsp;&nbsp;
                        <span style="color:{{x.status.color}}">{{x.status.text}}</span></div>
                </div>
            </a>
        </div>
        <ion-infinite-scroll on-infinite="getList()" distance="1%" ng-show="loadMoreFlag"></ion-infinite-scroll>
    </ion-content>
    <ion-content class="has-header search" ng-show="searchFlag"
                 ng-click="changeSearch($event)">
        <div ng-class="filterFlag?'own-backDrop-on':'own-backDrop-off'"
             ng-click="changeFilterFlag($event)"></div>
        <div class="listFilter selectionsDown pushDown-animated refer-selectionsDown"
             ng-class="{'slideOutUp':!filterFlag,'slideInDown':filterFlag}"
             ng-show="filterFlag" ng-click="filterPrevent($event)">
            <div class="type">类型</div>
            <div class="row typeRow row-wrap">
                <div class="typeSelections" ng-class="{'selected':x.flag}" ng-if="sysName==x.sysName" ng-click="filterSelect(x,'type')"
                     ng-repeat="x in filters.types">{{x.text}}
                </div>
            </div>
            <div class="status">状态</div>
            <div class="row statusRow row-wrap">
                <div class="typeSelections" ng-class="{'selected':x.flag}" ng-click="filterSelect(x,'status')"
                     ng-repeat="x in filters.statusFirst">{{x.text}}
                </div>
            </div>
            <div class="row row-wrap statusSecond">
                <div class="typeSelections" ng-class="{'selected':x.flag}" ng-click="filterSelect(x,'status')"
                     ng-repeat="x in filters.statusSecond">{{x.text}}
                </div>
            </div>
            <div class="bottomButton row">
                <div class="reset" ng-click="filterReset()">重置</div>
                <div class="sure" ng-click="filterSure()">确定</div>
            </div>
        </div>
        <div class="row row-center his-title" ng-if="!input.list">
            <i class="ion-android-time"></i>

            <div class="hisText">历史记录</div>
            <div class="horizon-line"></div>
        </div>
        <ion-list ng-if="!input.list">
            <ion-item ng-click="search(x,$event)" ng-repeat="x in hisArr">{{x}}</ion-item>
        </ion-list>
        <div class="content">
            <div class="list" ng-if="input.list">
                <a ng-click="goDetail(x,$event)" class="item" ng-repeat="x in saleListArr | filter:input.list">
                    <div class="row row-center">
                        <img class="title_oval" src="img/saleDetail/title_oval.png">
                        <div class="title" ng-bind-html="x.DESCRIPTION | highlight:input.list"></div>
                        <div class="col text-right"><img class="shape" src="img/saleDetail/Shape.png"></div>
                    </div>
                    <div class="row row-center sub-title">
                        <div class="col no-padding">潜在客户:&nbsp;&nbsp;<span ng-bind-html="x.PARTNER_TXT | highlight:input.list"></span></div>
                    </div>
                    <div class="row row-center sub-title" style="padding-top: 2px">
                        <div class="col col-50 no-padding">销售阶段:&nbsp;&nbsp;{{x.PHASE}}</div>
                        <div class="col col-50 chanStatus">状态:&nbsp;&nbsp;<span style="color:{{x.status.color}}">{{x.status.text}}</div>
                    </div>
                </a>
            </div>
        </div>
    </ion-content>
</ion-view>